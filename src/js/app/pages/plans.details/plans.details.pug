<div>
    <NavBar></NavBar>
    
    <section class="section section-white">
        <div class="container">
            <div v-if="!status || status === 'loading'">
                <!-- LOADING STATE -->
                <div class="notification full-width">
                    <img src="/img/spinner_dark.svg" width="20" class="spinner" />
                    <span>Chargement des données en cours...</span>
                </div>
            </div>

            <div v-else-if="status === 'loadingError'">
                <!-- ERROR STATE -->
                <div class="notification error full-width">
                    <span>{{ error }}. <span @click="load">Réessayer ?</span></span>
                </div>
            </div>

            <div v-else>
                <div class="container" ref="header">
                    <div class="town-actionButtons">
                        <button v-if="hasPermission({ type: 'feature', name: 'deletePlan' })" @click="destroy" class="button warning">Supprimer le dispositif</button>
                    </div>
                </div>

                <div class="dashboard">
                    <aside class="side-menu">
                        <ul>
                            <li><a v-bind:class="{ active: currentTab === 'main' }" @click="showTab('main')">Caractéristiques du dispositif</a></li>
                            <li v-for="detail in details"><a v-bind:class="{ active: currentTab === detail.id }" @click="showTab(detail.id)">{{ detail.label }}</a></li>
                        </ul>
                    </aside>

                    <div class="main">
                        <div v-if="currentTab === 'main'">
                            <div class="panel">
                                <div class="panel__header">
                                    <h3>1. Caractéristiques générales</h3>
                                </div>
                                <div class="form__group">
                                    <p v-if="plan.name">
                                        <strong>Nom du dispositif :</strong> {{ plan.name }}
                                    </p>
                                    <p>
                                        <strong>Type de dispositif :</strong> {{ plan.type.label }}
                                    </p>
                                    <p>
                                        <strong>Dispositif démarré le :</strong> {{ formatDate(plan.startedAt) }}
                                    </p>
                                </div>
                            </div>

                            <div class="panel">
                                <div class="panel__header">
                                    <h3>2. Opérateur en charge</h3>
                                </div>
                                <div class="form__group">
                                    <p>
                                        <strong>Nom de l'opérateur :</strong> {{ plan.ngo.name }}
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div v-else>
                            <div class="panel">
                                <div class="panel__header">
                                    <h3>1. Caractéristiques de suivi</h3>
                                </div>
                                <div class="form__group">
                                    <p v-for="field in customFields">
                                        <strong>{{ field.label }} :</strong> {{ field.value }}
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>