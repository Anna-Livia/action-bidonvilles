<div>
    <NavBar></NavBar>

    <section v-if="loading || error" class="section section-white">
        <div class="container" v-if="loading || error">
            <div v-if="loading">
                <!-- LOADING STATE -->
                <div class="notification full-width">
                    <img src="/img/spinner_dark.svg" width="20" class="spinner" />
                    <span>Chargement des données en cours...</span>
                </div>
            </div>

            <div v-else-if="error">
                <!-- ERROR STATE -->
                <div class="notification error full-width">
                    <span>{{ error }}. <a href="#" @click="fetchData">Réessayer ?</a></span>
                </div>
            </div>
        </div>
    </section>

    <section v-else class="section section-white town-wrapper" ref="wrapper">
        <CommentDeletion v-if="commentToBeDeleted !== null" :comment="commentToBeDeleted" @close="closeCommentDeletion" @deleted="onCommentDeleted" ref="commentDeletionPopin"></CommentDeletion>

        <div class="popin" v-if="mode === 'close'">
            <div class="popin-wrapper" ref="wrapper">
                <div>
                    <p class="popin-close"><span class="link" @click="closePopin"><font-awesome-icon icon="times" size="2x"></font-awesome-icon></span></p>
                    <section>
                        <h2>Disparition du site</h2>
                        <div class="form__group">
                            <label v-bind:class="{ error: fieldErrors.closed_at }">Date de disparition du site :</label>
                            <p class="error" v-if="fieldErrors.closed_at">
                                <ul>
                                    <li v-for="error in fieldErrors.closed_at">{{ error }}</li>
                                </ul>
                            </p>
                            <datepicker :clear-button="true" :language="dateLanguage" :monday-first="true" :disabled-dates="{ from: new Date() }" :full-month-name="true" :format="'dd MMMM yyyy'" v-model="edit.closedAt"></datepicker>
                        </div>

                         <div class="form__group">
                            <fieldset>
                                <legend v-bind:class="{ error: fieldErrors.closed_with_solutions }">
                                    <strong>Est-ce que ce site a été résorbé définitivement ? :</strong>
                                </legend>
                                <p class="question-info">C’est-à-dire sans réinstallation illicite et avec un accompagnement de la majorité des personnes vers des solutions pérennes</p>
                                <p class="error" v-if="fieldErrors.closed_with_solutions">
                                    <ul>
                                        <li v-for="error in fieldErrors.closed_with_solutions">{{ error }}</li>
                                    </ul>
                                </p>

                                <div v-for="(value, index) in closedWithSolutionsValues">
                                    <input type="radio" name="closed_with_solutions" :id="'status' + index" :value="value.value" v-model="edit.closedWithSolutions">
                                    <label :for="'status' + index" class="label-inline">{{ value.label }}</label>
                                </div>
                            </fieldset>
                        </div>

                        <div class="form__group">
                            <fieldset>
                                <legend v-bind:class="{ error: fieldErrors.status }">
                                    <strong>Cause de la disparition :</strong>
                                </legend>
                                <p class="error" v-if="fieldErrors.status">
                                    <ul>
                                        <li v-for="error in fieldErrors.status">{{ error }}</li>
                                    </ul>
                                </p>
                                <div v-for="(value, index) in statusValues">
                                    <input type="radio" name="status" :id="'status' + index" :value="value.value" v-model="edit.status">
                                    <label :for="'status' + index" class="label-inline">{{ value.label }}</label>
                                </div>
                            </fieldset>
                        </div>

                        <div class="form__group">
                            <fieldset>
                                <legend v-bind:class="{ error: fieldErrors.solutions }">
                                    <strong>Orientations des ménages :</strong>
                                </legend>
                                <fieldset v-for="(value, index) in closingSolutions">
                                    <legend>
                                        <input type="checkbox" name="closingSolution" :id="'closingSolution' + index" :value="value.id" v-model="edit.solutions[value.id].checked">
                                        <label :for="'closingSolution' + index" class="label-inline">{{ value.label }}</label>
                                    </legend>
                                    <div class="solution-people" v-bind:class="{ visible: edit.solutions[value.id].checked }">
                                        <p class="error" v-if="fieldErrors.solutions && fieldErrors.solutions[value.id]">
                                            <ul>
                                                <li v-for="error in fieldErrors.solutions[value.id]">{{ error }}</li>
                                            </ul>
                                        </p>
                                        <p>Nombre de ménages concernés :<br/><input type="number" v-model="edit.solutions[value.id].householdsAffected" /></p>
                                        <p>Nombre de personnes concernées :<br/><input type="number" v-model="edit.solutions[value.id].peopleAffected" /></p>
                                    </div>
                                </fieldset>
                            </fieldset>
                        </div>

                        <div class="notification error" v-if="editError">{{ editError }}.</div>

                        <div class="form__group">
                            <button @click="submitClose" class="button">Valider</button>
                            <button @click="closePopin" class="button secondary">Annuler</button>
                        </div>
                    </section>
                </div>
            </div>
        </div>

        <header class="town-header" ref="header">
            <div class="container">
                <div class="town-name">
                    <div class="town-reference">
                        <h1>Site {{ town.addressSimple }} <span :class="`town-status ${town.status}`">{{ status }}</span></h1>
                        <h2>{{ town.city.name }}</h2>
                    </div>

                    <div class="town-actionButtons">
                        <button v-if="town.status === 'open' && mode !== 'edit' && hasPermission('shantytown.close', town)" @click="setCloseMode" class="button secondary">Fermer le site</button>
                        <button v-if="town.status === 'open' && mode !== 'edit' && hasPermission('shantytown.update', town)" @click="setEditMode" class="button">Modifier le site</button>
                        <button v-if="mode !== 'edit' && hasPermission('shantytown.delete', town)" @click="destroy" class="button warning">Supprimer le site</button>
                        <button v-if="mode === 'edit'" @click="submit" class="button">Sauvegarder</button>
                        <button v-if="mode === 'edit'" @click="setViewMode" class="button warning">Annuler</button>
                    </div>
                </div>

                <div class="town-info">
                    <p class="town-links" v-if="town.changelog.length > 0">
                        <span class="link" @click="showAside('changelog')" data-group="sidePanelLink"><font-awesome-icon icon="history"></font-awesome-icon> &nbsp;Modifié le {{ formatDate(town.updatedAt, 'd M y') }} - voir l'historique</span>
                    </p>
                    <p class="town-links" v-if="hasPermission('shantytown_comment.list', town)">
                        <span class="link" @click="showAside('comments')" data-group="sidePanelLink"><font-awesome-icon icon="comment"></font-awesome-icon> &nbsp;{{ town.comments.regular.length }} commentaire{{ town.comments.regular.length > 1 ? 's' : '' }}</span>
                    </p>
                    <p class="town-links town-links--covid" v-if="hasPermission('covid_comment.list')">
                        <span class="link" @click="showAside('covidComments')" data-group="sidePanelLink"><font-awesome-icon icon="comment"></font-awesome-icon> &nbsp;{{ town.comments.covid.length }} commentaire{{ town.comments.covid.length > 1 ? 's' : '' }} COVID-19</span>
                    </p>
                </div>
            </div>
        </header>

        <div class="town-main" ref="main">
            <div class="sidepanel" v-bind:class="{ 'sidepanel--visible': sidePanel !== null }">
                <div class="sidepanel-shadow"></div>

                <div class="sidepanel-wrapper" ref="aside">
                    <div class="sidepanel-actions">
                        <span @click="hideAside"><font-awesome-icon icon="times" size="2x"></font-awesome-icon></span>
                    </div>

                    <div v-if="sidePanel === 'changelog'">
                        <header class="sidepanel-header">
                            <h1 class="sidepanel-title"><font-awesome-icon icon="history"></font-awesome-icon> &nbsp;Historique des modifications</h1>
                        </header>

                        <div class="sidepanel-content">
                            <div class="sidepanel-section" v-for="changelog in town.changelog">
                                <article class="userpost userpost--changelog">
                                    <header class="userpost-header">
                                        <p class="userpost-date"><time>{{ formatDate(changelog.date, 'd M y à h:i') }}</time></p>
                                        <h1 class="userpost-title">
                                            <router-link :to="`/annuaire/${changelog.author.organization.id}`">
                                                <font-awesome-icon icon="user"></font-awesome-icon>
                                                <span>{{ changelog.author.last_name.toUpperCase() }} {{ changelog.author.first_name }}</span>
                                            </router-link>
                                        </h1>
                                    </header>

                                    <p v-for="diff in changelog.diff" class="changelog">
                                        <span class="changelog-name">{{ diff.field }} :</span><br/>
                                        <span class="changelog-oldValue" v-bind:class="{ 'changelog-value--unknown': !diff.oldValue }">{{ diff.oldValue || 'non renseigné' }}</span>,
                                        <span class="changelog-newValue" v-bind:class="{ 'changelog-value--unknown': !diff.newValue }">{{ diff.newValue || 'non renseigné' }}</span>
                                    </p>
                                </article>
                            </div>
                        </div>
                    </div>

                    <div v-if="sidePanel === 'comments'">
                        <header class="sidepanel-header">
                            <h1 class="sidepanel-title"><font-awesome-icon icon="comment"></font-awesome-icon> &nbsp;Commentaires</h1>
                        </header>

                        <div class="sidepanel-content">
                            <div class="sidepanel-section">
                                <div class="comment-form" v-if="hasPermission('shantytown_comment.create', town)">
                                    <h1>Ajouter un commentaire</h1>
                                    <p>Merci de respecter les règles de confidentialité. Ne pas citer l’identité des individus (Nom, âge, sexe, origine...)</p>

                                    <p class="error" v-if="commentErrors.description">
                                        <ul>
                                            <li v-for="error in commentErrors.description">{{ error }}</li>
                                        </ul>
                                    </p>

                                    <div class="input__group">
                                        <textarea v-model="newComment"></textarea>
                                    </div>
                                    <p><button class="button large" @click="addComment">Ajouter le commentaire</button></p>
                                </div>
                            </div>

                            <div class="sidepanel-section" v-if="town.comments.regular.length === 0">
                                <p>Aucun commentaire enregistré pour le moment</p>
                            </div>

                            <div class="sidepanel-section" v-for="comment in town.comments.regular">
                                <article class="userpost userpost--comment">
                                    <header class="userpost-header">
                                        <p class="userpost-date"><time>{{ formatDate(comment.createdAt, 'd M y à h:i') }}</time></p>
                                        <h1 class="userpost-title">
                                            <router-link :to="`/annuaire/${comment.createdBy.organizationId}`">
                                                <font-awesome-icon icon="user"></font-awesome-icon>
                                                <span>{{ comment.createdBy.lastName.toUpperCase() }} {{ comment.createdBy.firstName }}</span>
                                            </router-link>
                                            <span class="userpost-actions">
                                                <font-awesome-icon icon="pencil-alt" class="userpost-action--edit" v-if="canEditComment(comment)" @click="editComment(comment)"></font-awesome-icon>
                                                <font-awesome-icon icon="trash-alt" class="userpost-action--delete" v-if="canDeleteComment(comment)" @click="deleteComment(comment)"></font-awesome-icon>
                                            </span>
                                        </h1>
                                    </header>

                                    <div v-if="commentEdit.commentId === comment.id">
                                        <p class="error" v-if="commentEdit.error">
                                            <ul>
                                                <li>{{ commentEdit.error }}</li>
                                            </ul>
                                        </p>
                                        <textarea v-model="commentEdit.value" :disabled="commentEdit.pending"></textarea>
                                        <p>
                                            <button class="button" @click="sendEditComment(comment)">Modifier</button>
                                            <button class="button warning" @click="cancelEditComment">Annuler</button>
                                        </p>
                                    </div>
                                    <p v-else>{{ comment.description }}</p>
                                </article>
                            </div>
                        </div>
                    </div>

                    <div v-if="sidePanel === 'covidComments'">
                        <header class="sidepanel-header">
                            <h1 class="sidepanel-title"><font-awesome-icon icon="comment"></font-awesome-icon> &nbsp;Commentaires COVID-19</h1>
                        </header>

                        <div class="sidepanel-content">
                            <div class="sidepanel-section">
                                <div class="comment-form">
                                    <h1>Ajouter un commentaire COVID-19</h1>
                                    <p>Merci de préciser votre action, ses modalités, et le nombre de personnes avec des symptômes.</p>
                                    <p>Merci de respecter les règles de confidentialité. Ne pas citer l’identité des individus (Nom, âge, sexe, origine...)</p>

                                    <p class="covid-header error" v-if="covidErrors.length > 0">
                                        <span class="error">Le fomulaire comporte des erreurs :</span>
                                        <ul>
                                            <li v-for="error in covidErrors">{{ error }}</li>
                                        </ul>
                                    </p>

                                    <div class="covid-header">
                                        <label><strong>Date de votre intervention :</strong></label>
                                        <datepicker :language="dateLanguage" :monday-first="true" :disabled-dates="{ to: town ? new Date(town.builtAt * 1000) : undefined, from: new Date() }" :full-month-name="true" :format="'dd MMMM yyyy'" v-model="covidComment.date"></datepicker>
                                    </div>

                                    <p class="covid-header"><strong>Préciser votre intervention :</strong></p>
                                    <div class="input__group">
                                        <label for="covid-equipeMaraude">
                                            <input type="checkbox" id="covid-equipeMaraude" name="covid-equipeMaraude" v-model="covidComment.equipe_maraude" class="input input--checkbox" /> Équipe de maraude
                                        </label>
                                    </div>

                                    <div class="input__group">
                                        <label for="covid-equipeSanitaire">
                                            <input type="checkbox" id="covid-equipeSanitaire" name="covid-equipeSanitaire" v-model="covidComment.equipe_sanitaire" class="input input--checkbox" /> Équipe sanitaire
                                        </label>
                                    </div>

                                    <div class="input__group">
                                        <label for="covid-equipeAccompagnement">
                                            <input type="checkbox" id="covid-equipeAccompagnement" name="covid-equipeAccompagnement" v-model="covidComment.equipe_accompagnement" class="input input--checkbox" /> Équipe d'accompagnement
                                        </label>
                                    </div>

                                    <div class="input__group">
                                        <label for="covid-distributionAlimentaire">
                                            <input type="checkbox" id="covid-distributionAlimentaire" name="covid-distributionAlimentaire" v-model="covidComment.distribution_alimentaire" class="input input--checkbox" /> Distribution d'aide alimentaire
                                        </label>
                                    </div>

                                    <p class="covid-header"><strong>Signaler si nécessaire :</strong></p>
                                    <div class="input__group">
                                        <label for="covid-personnesOrientees">
                                            <input type="checkbox" id="covid-personnesOrientees" name="covid-personnesOrientees" v-model="covidComment.personnes_orientees" class="input input--checkbox" /> Personne(s) orientée(s) vers un centre d'hébergement spécialisé (desserrement)
                                        </label>
                                    </div>

                                    <div class="input__group">
                                        <label for="covid-personnesAvecSymptomes">
                                            <input type="checkbox" id="covid-personnesAvecSymptomes" name="covid-personnesAvecSymptomes" v-model="covidComment.personnes_avec_symptomes" class="input input--checkbox" /> Personne(s) avec des symptômes Covid-19
                                        </label>
                                    </div>

                                    <div class="input__group">
                                        <label for="covid-besoinAction">
                                            <input type="checkbox" id="covid-besoinAction" name="covid-v" v-model="covidComment.besoin_action" class="input input--checkbox" /> Besoin d'une action prioritaire
                                        </label>
                                    </div>

                                    <div class="input__group">
                                        <textarea v-model="covidComment.description"></textarea>
                                    </div>
                                    <p><button class="button large" @click="addCovidComment">Ajouter le commentaire</button></p>
                                </div>
                            </div>

                            <div class="sidepanel-section" v-if="town.comments.covid.length === 0">
                                <p>Aucun commentaire enregistré pour le moment</p>
                            </div>

                            <div class="sidepanel-section" v-for="comment in town.comments.covid">
                                <article class="userpost userpost--comment">
                                    <header class="userpost-header">
                                        <p class="userpost-date">Publié le : <time>{{ formatDate(comment.createdAt, 'd M y à h:i') }}</time></p>
                                        <p class="userpost-date">Date de l'intervention : <time>{{ formatDate(comment.covid.date, 'd M y') }}</time></p>
                                        <h1 class="userpost-title">
                                            <router-link :to="`/annuaire/${comment.createdBy.organizationId}`">
                                                <font-awesome-icon icon="user"></font-awesome-icon>
                                                <span>{{ comment.createdBy.lastName.toUpperCase() }} {{ comment.createdBy.firstName }}</span>
                                            </router-link>
                                        </h1>
                                    </header>
                                    <p v-for="tag in covidTags" v-if="comment.covid[tag.prop] === true" class="covidTag">
                                        <span :class="`rbTag rbTag--${tag.type}`">{{ tag.label }}</span>
                                    </p>
                                    <p>{{ comment.description }}</p>
                                </article>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SUCCESS STATE -->
            <div class="container">
                <div class="notification error full-width" v-if="deleteError !== null">
                    <span>{{ deleteError }}</span>
                </div>

                <div v-if="view === 'details'">
                    <div v-if="mode === 'view'">
                        <div class="panel">
                            <div class="panel__header">
                                <h3>1. Situation du site</h3>
                            </div>
                            <div class="form__group">
                                <p v-if="town.priority">
                                    <strong>Niveau de priorité du site :</strong> {{ town.priority }}
                                </p>
                                <p v-if="town.builtAt !== undefined">
                                    <strong>Date d'installation du site :</strong> {{ town.builtAt !== null ? formatDate(town.builtAt) : 'Inconnue' }}
                                </p>
                                <p v-if="town.declaredAt !== undefined">
                                    <strong>Date de signalement du site :</strong> {{ town.declaredAt !== null ? formatDate(town.declaredAt) : 'Inconnue' }}
                                </p>
                                <p v-if="town.status !== 'open' && town.closedAt !== undefined">
                                    <strong>Date de disparition du site :</strong> {{ town.closedAt !== null ? formatDate(town.closedAt) : 'Inconnue'}}
                                </p>
                                <p v-if="town.status !== 'open'">
                                    <strong>Cause de la disparition :</strong> {{ statusLabel }}
                                </p>
                                <p v-if="town.status !== 'open' && town.closingSolutions !== undefined">
                                    <strong>Orientation des ménages :</strong><span v-if="town.closingSolutions.length === 0"> aucune</span>
                                    <ul v-if="town.closingSolutions.length > 0">
                                        <li v-for="solution in town.closingSolutions">
                                            <span>{{ closingSolutions.find(s => s.id === solution.id).label }}</span>
                                            <ul>
                                                <li v-for="detail in formatSolution(solution)">{{ detail }}</li>
                                            </ul>
                                        </li>
                                    </ul>
                                </p>
                            </div>
                        </div>

                        <div class="panel">
                            <div class="panel__header">
                                <h3>2. Localisation</h3>
                            </div>
                            <div class="form__group">
                                <p v-if="town.address !== undefined">
                                    <strong>Adresse :</strong> {{ town.address }}
                                </p>
                                <p v-if="town.addressDetails !== undefined">
                                    <strong>Informations d'accès :</strong> {{ town.addressDetails }}
                                </p>
                                <Map :display-searchbar="false" :towns="[ town ]" :default-view="center"></Map>
                                <p v-if="town.fieldType !== undefined   ">
                                    <strong>Type de site :</strong> {{ town.fieldType.label }}
                                </p>
                                <p v-if="town.ownerType !== undefined">
                                    <strong>Type de propriétaire :</strong> {{ town.ownerType.label }}
                                </p>
                                <p v-if="town.owner !== undefined">
                                    <strong>Propriétaire :</strong> {{ town.owner || 'Inconnu' }}
                                </p>
                            </div>
                        </div>

                        <div class="panel">
                            <div class="panel__header">
                                <h3>3. Habitants</h3>
                            </div>
                            <div class="form__group">
                                <p v-if="town.censusStatus !== undefined">
                                    <strong>Statut du diagnostic :</strong> {{ town.censusStatus === 'done' ? 'Réalisé' : (town.censusStatus === 'scheduled' ? 'Prévu' : (town.censusStatus === 'none' ? 'Non prévu' : 'Inconnu')) }}
                                </p>
                                <p v-if="town.censusConductedAt !== undefined">
                                    <strong>Date du diagnostic :</strong> {{ town.censusConductedAt !== null ? formatDate(town.censusConductedAt) : 'Inconnue' }}
                                </p>
                                <p v-if="town.censusConductedBy !== undefined">
                                    <strong>Opérateur en charge du diagnostic :</strong> {{ town.censusConductedBy || 'Inconnu' }}
                                </p>
                                <p v-if="town.populationTotal !== undefined">
                                    <strong>Nombre de personnes :</strong> {{ town.populationTotal !== null ? town.populationTotal : 'inconnu' }}
                                </p>
                                <p v-if="town.populationCouples !== undefined">
                                    <strong>Nombre de ménages :</strong> {{ town.populationCouples !== null ? town.populationCouples : 'inconnu' }}
                                </p>
                                <p v-if="town.populationMinors !== undefined">
                                    <strong>Nombre de mineurs :</strong> {{ town.populationMinors !== null ? town.populationMinors : 'inconnu' }}
                                </p>
                                <p v-if="town.socialOrigins !== undefined">
                                    <strong>Origines :</strong>
                                    <ul v-if="town.socialOrigins.length > 0">
                                        <li v-for="origin in town.socialOrigins">{{ origin.label }}</li>
                                    </ul>
                                    <span v-else>inconnues</span>
                                </p>
                            </div>
                        </div>

                        <div class="panel">
                            <div class="panel__header">
                                <h3>4. Conditions de vie</h3>
                            </div>
                            <div class="form__group">
                                <p>
                                    <strong>Accès à l'électricité:</strong> {{ town.electricityType.label }}
                                </p>
                                <p>
                                    <strong>Modalités d'accès à l'électricité :</strong> {{ town.electricityComments }}
                                </p>
                                <p v-if="town.accessToWater !== undefined">
                                    <strong>Accès à l'eau :</strong> {{ town.accessToWater !== null ? (town.accessToWater ? 'oui' : 'non') : 'inconnu' }}
                                </p>
                                <p v-if="town.accessToWater === true">
                                    <strong>Modalités d'accès à l'eau :</strong> {{ town.waterComments }}
                                </p>
                                <p v-if="town.trashEvacuation !== undefined">
                                    <strong>Évacuation des déchets :</strong> {{ town.trashEvacuation !== null ? (town.trashEvacuation ? 'oui' : 'non') : 'inconnu' }}
                                </p>
                            </div>
                        </div>

                        <div class="panel" v-if="hasPermission('shantytown.list.data_justice', town)">
                            <div class="panel__header">
                                <h3>5. Procédure judiciaire d’expulsion des occupants</h3>
                            </div>
                            <div class="form__group">
                                <p v-if="town.ownerComplaint !== undefined">
                                    <strong>Dépôt de plainte par le propriétaire :</strong> {{ town.ownerComplaint === null ? 'Inconnu' : (town.ownerComplaint ? 'Oui' : 'Non') }}
                                </p>
                                <p v-if="town.ownerComplaint && town.justiceProcedure !== undefined">
                                    <strong>Existence d’une procédure judiciaire :</strong> {{ town.justiceProcedure === null ? 'Inconnu' : (town.justiceProcedure ? 'Oui' : 'Non') }}
                                </p>
                                <p v-if="town.justiceProcedure && town.justiceRendered !== undefined">
                                    <strong>Décision de justice rendue :</strong> {{ town.justiceRendered === null ? 'Inconnu' : (town.justiceRendered ? 'Oui' : 'Non') }}
                                </p>
                                <p v-if="town.justiceRendered && town.justiceRenderedBy !== undefined">
                                    <strong>Origine de la décision :</strong> {{ town.justiceRenderedBy || 'Inconnue' }}
                                </p>
                                <p v-if="town.justiceRendered && town.justiceRenderedAt !== undefined">
                                    <strong>Date de la décision :</strong> {{ town.justiceRenderedAt !== null ? formatDate(town.justiceRenderedAt) : 'Inconnue' }}
                                </p>
                                <p v-if="town.justiceRendered && town.justiceChallenged !== undefined">
                                    <strong>Contentieux relatif à la décision de justice :</strong> {{ town.justiceChallenged === null ? 'Inconnu' : (town.justiceChallenged ? 'Oui' : 'Non') }}
                                </p>
                                <p v-if="town.policeStatus !== undefined">
                                    <strong>Concours de la force publique :</strong> {{ town.policeStatus === 'granted' ? 'Obtenu' : (town.policeStatus === 'requested' ? 'Demandé' : 'Inconnu') }}
                                </p>
                                <p v-if="town.policeRequestedAt !== undefined">
                                    <strong>Date de la demande du CFP :</strong> {{ town.policeRequestedAt !== null ? formatDate(town.policeRequestedAt) : 'Inconnue' }}
                                </p>
                                <p v-if="town.policeGrantedAt !== undefined">
                                    <strong>Date d'octroi du CFP :</strong> {{ town.policeGrantedAt !== null ? formatDate(town.policeGrantedAt) : 'Inconnue' }}
                                </p>
                                <p v-if="town.bailiff !== undefined">
                                    <strong>Nom de l'étude d'huissiers :</strong> {{ town.bailiff || 'Inconnues' }}
                                </p>
                            </div>
                        </div>
                    </div>

                    <div v-if="mode === 'edit'">
                        <TownEdit :initialData="edit" />

                        <div class="notification error" v-if="editError">{{ editError }}.</div>

                        <div class="form__group">
                            <button class="button large" @click="submit">Sauvegarder</button>
                        </div>
                    </div>
                </div>

                <!-- actions -->
                <div v-else-if="view === 'actions'">
                    <div class="panel" v-for="action in town.actions">
                        <div class="panel__header">
                            <h3><router-link :to="'/action/' + action.id">{{ action.name }}</router-link> - <small class="panel__header-extra">Débutée le {{ formatDate(action.startedAt) }}</small></h3>
                        </div>
                        <p><strong>Type de l'action :</strong> {{ action.type }}</p>
                        <p><strong>Détails de l'action :</strong></p>
                        <p>{{ action.description || 'Aucun détails fournis' }}</p>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>
